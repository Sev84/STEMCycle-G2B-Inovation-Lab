<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STEMCycle G2B Lab Hub</title>
    <!-- Tailwind CSS Yüklemesi -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font Yüklemesi -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet (Harita) CSS Yüklemesi -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/SJPMeIegerwBLpT6A="
     crossorigin=""/>
    
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f0f9ff; /* Açık gökyüzü mavisi */
            position: relative; 
            min-height: 100vh;
        } 
        
        body::before {
            content: '';
            position: fixed; 
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/cubes.png');
            opacity: 0.05; 
            z-index: -1; 
            pointer-events: none;
        }
        
        #app {
            position: relative; 
            z-index: 1; 
            overflow-x: hidden; 
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
        }
        
        main {
            flex-grow: 1; 
        }

        .header-blue { background-color: #00796b; }
        .accent-blue { background-color: #00838f; }
        .accent-green { background-color: #4caf50; }
        /* DÜZELTME: .tab-button.active yerine .tab-active kullanıldı */
        .tab-button.tab-active { 
            border-bottom: 3px solid #00838f; 
            color: #00838f; 
            font-weight: 600; 
        }
        .announcement-card { border-left: 4px solid #ffb300; }
        .project-card { border-top: 5px solid #00838f; }
        .lab-accent { background-color: #ffb300; }
        
        #user-map { height: 300px; width: 100%; border-radius: 12px; margin-bottom: 1.5rem; z-index: 5; background-color: #e0f2fe; } 
        
        .module { cursor: grab; user-select: none; }
        .module:active { cursor: grabbing; }
        #kit-canvas { 
            min-height: 250px; 
            background-color: #e2e8f0; 
            border: 2px dashed #94a3b8;
            position: relative;
        }
        
        .custom-div-icon { 
            background-color: transparent !important; 
            border: none !important;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .score-marker {
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            color: white; 
            font-size: 12px; 
            font-weight: bold; 
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(0,0,0,0.2); 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); 
        }

         .header-logo {
            height: 1.25rem; /* h-5 */
            margin-left: 0.75rem; /* ml-3 */
            opacity: 0.9;
            display: inline-block; 
            vertical-align: middle; 
        }
        /* Small screens and up */
        @media (min-width: 640px) { 
             .sm\:inline-block { display: inline-block !important; }
             .header-logo { margin-left: 1rem; } /* sm:ml-4 */
             .header-logo.codeweek { height: 1.5rem; } /* sm:h-6 */
        }
        
    </style>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
</head>
<body class="min-h-screen">

    <div id="app">
        
        <!-- Hesap Oluşturma/Giriş Modalı -->
        <div id="auth-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-sm">
                <h1 class="text-2xl font-bold mb-4 text-center text-accent-blue" data-i18n="welcome_title">HOŞ GELDİNİZ</h1>
                <div class="space-y-3 mb-6">
                    <h2 class="text-sm font-semibold text-gray-700" data-i18n="esep_students_title">Öğrenci Girişleri ve Kaynaklar:</h2>
                    <a href="https://school-education.ec.europa.eu/en/pupil-login" target="_blank" class="block p-3 bg-green-100 border border-green-300 rounded-lg hover:bg-green-200 transition">
                        <p class="font-bold text-green-700 text-sm" data-i18n="esep_login_btn">ESEP/eTwinning Öğrenci Girişi</p>
                    </a>
                    <a href="https://school-education.ec.europa.eu/en/" target="_blank" class="block p-3 bg-blue-100 border border-blue-300 rounded-lg hover:bg-blue-200 transition">
                        <p class="font-bold text-blue-700 text-sm" data-i18n="esep_platform_btn">ESEP Okul Eğitimi Platformu</p>
                    </a>
                </div>
                <h2 class="text-xl font-bold mb-4 text-center text-accent-blue border-t pt-4" data-i18n="hub_login_title">STEMCycle Hub Girişi</h2>
                <div id="register-ui">
                    <h3 class="font-bold text-sm mb-2 text-gray-700" data-i18n="new_register_title">Yeni Kayıt / Bilgi Güncelleme</h3>
                    <input type="text" id="user-name-input" placeholder="Adınız, Soyadınız" class="w-full p-2 border rounded-lg mb-3">
                    <input type="email" id="user-email-input" placeholder="E-posta (Opsiyonel)" class="w-full p-2 border rounded-lg mb-3">
                    <input type="text" id="user-school-input" placeholder="Okulunuz / Ülkeniz" class="w-full p-2 border rounded-lg mb-4">
                    <button onclick="registerUser()" class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700">Kayıt Ol / Güncelle</button>
                </div>
                <div id="login-ui" class="mt-4">
                    <h3 class="font-bold text-sm mb-2 text-gray-700 border-t pt-4" data-i18n="guest_login_title">Veya Misafir Olarak Devam Et</h3>
                    <button onclick="loginUser()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700">Misafir Girişi</button>
                </div>
                <div class="p-4 flex flex-wrap justify-center items-center space-x-4 mt-4 border-t">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMwIiB2aWV3Qm94PSIwIDAgMTAwIDMwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiMwMDQ0OTQiIGQ9Ik0wIDIuNzQ2aDEuNzM4VjI3LjI1NEgwVjIuNzQ2ek0zLjI3IDIuNzQ2aDQuMDQ4YzIuODEgMCA0LjM2OC41MyA1LjY3NSAyLjE5NyAxLjMwNSAxLjY2NyAxLjIwOCAzLjg2NyAxLjk1OCA2LjYwMiAwIDIuNzM0LS42NTMgNC45MzQtMS45NTggNi42MDItMS4zMDcuMTY2Ny0yLjg2NSAyLjE5Ny01LjY3NSAyLjE5N0gzLjI3VjIuNzQ2Wm0xLjc0IDYuMDYydjcuMjNoMi4zMDhjMi4wMSAwIDIuOTI4LS44MjIgMi45MjgtMi4yNzOTIgMC0yLjA1My0uOTE5LTIuNzUzLTIuNzgtMi43NTNINS4wMXpNMTUuODQ4IDIuNzQ2aDQuMDQ4YzIuODEgMCA0LjM2OC41MyA1LjY3NSAyLjE5NyAxLjMwNSAxLjY2NyAxLjk1OCAzLjg2NyAxLjk1OCA2LjYwMiAwIDIuNzM0LS42NTMgNC45MzQtMS45NTggNi42MDItMS4zMDcuMTY2Ny0yLjg2NSAyLjE5Ny01LjY3NSAyLjE5N0gxNS44NThWMi43NDZabTEuNzQgNi4wNjJ2Ny4yM2gyLjMwOGMyLjAxIDAgMi45MjgtLjgyMiAyLjkyOC0yLjc5MiAwLTIuMDUzLS45MTktMi43NTMtMi43OC0yLjc1M2gtMi4xNDhaTTI4LjQyNyAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1IDQuODEgMi4wNTcgMS40MzIgMS4zNzIgMi4xNDggMy4xNzcgMi4xNDggNS40MTUgMCAyLjE5Ny0uNzE2IDMuOTk3LTIuMTQ4IDUuNHMtMy4wMyAyLjEtNC44MSAyLjFjLTEuNyAwLTMuMjU3LS42OS00LjY3LTIuMDY5VjI3LjI1NGgtMS43MzhWMi43NDZoMS43Mzh2Ni44NTZaTTMzLjA5NyA5LjE5YzAgMS43NTguNTMgMy4xMTggMS41OTEgNC4wNzkgMS4wNi45NiAyLjMzOCAxLjQ0IDMuODQzIDEuNDQgMS41NDggMCAyLjg1MS0uNDggMy44ODYtMS40NCAxLjAzNS0uOTYgMS41NTMtMi4zMiAxLjU1My00LjA3OSAwLTEuNzE2LS41MTgtMy4wNjgtMS41NTMtNC4wNTktMS4wMzUtLjk5LTIuMzM4LTEuNDg1LTMuODg2LTEuNDg1LTEuNTA1IDAtMi43ODMuNDk1LTMuODQzIDEuNDg1LTEuMDYgMS0xLjU5MSAyLjM0My0xLjU5MSA0LjA1OVpNNTAuMTI3IDIuNzQ2aDMuMjE2bC0zLjAzIDkuMzE4LTUuNjU0LTkuMzE4aC0zLjU2M2w3LjIzIDExLjk0Ny43NDIgMS4yMzVoLTEuNjQxbC0xLjk3OS0zLjI2aC0uOTM4bC0uODk2IDEuNDI3IDIuMTEyIDMuNDkzaDMuMzIzbDYuOTI0LTExLjQwM2gxLjc2bC01LjUyIDkuMDg4IDQuMzY4IDcuMTY4aC0zLjMyMmwtMi44NzctNC4yMTUtMS41MzEgMi41MmgxLjQ2N2wuODI4IDEuMzY4aC45NThsLjY3OCAxLjExNGgtNy45NjhsLjY3OC0xLjExNGguOTU4bC44MjgtMS4zNjhoMS40NjdMNDEuNiAyNy4yNTRsLTUuNzgtOS45MjVMODAuMDM0IDIuNzQ2aC0uNjU2bC01LjY1MyA5LjMxOEw2OC4wNDQgMi43NDZoLTMuMjE2bDQuNjkyIDcuNzYyIDQuNDUtNy43NjJoMy41NjNsLTcuMjMgMTEuOTQ3LS43NDIgMS4yMzVoMS42NDFsMS45OC0zLjI2aC45MzhsLjg5NiAxLjQyNy0yLjExMiAzLjQ5M2gtMy4zMjNMNTguMyAxNS44NGwtNi45MjQtMTEuNDAzaC0xLjc2bDUuNTIgOS4wODgtNC4zNjggNy4xNjhoMy4zMjJsMi44NzctNC43MTUgMS41MzIgMi41MmgtMS40NjdsLS44MjggMS4zNjhoLS45NThsLS42NzgtMS4xMTRoNy45NjhMNTkuMzU4IDI3LjI1NGw1Ljc4LTkuNTI1IDQuNjQ2IDcuNTI1aC42NTZaTTY5LjEyNyAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1IDQuODEgMi4wNTcgMS40MzIgMS4zNzIgMi4xNDggMy4xNzcgMi4xNDggNS40MTUgMCAyLjE5Ny0uNzE2IDMuOTk3LTIuMTQ4IDUuNHMtMy4wMyAyLjEtNC44MSAyLjFjLTEuNyAwLTMuMjU3LS42OS00LjY3LTIuMDY5VjI3LjI1NGgtMS43MzhWMi43NDZoMS43Mzh2Ni44NTZaTTczLjc5NyA5LjE5YzAgMS43NTguNTMgMy4xMTggMS41OTEgNC4wNzkgMS4wNi45NiAyLjMzOCAxLjQ0IDMuODQzIDEuNDQgMS41NDggMCAyLjg1MS0uNDggMy44ODYtMS40NCAxLjAzNS0uOTYgMS41NTMtMi4zMiAxLjU1My00LjA3OSAwLTEuNzE2LS41MTgtMy4wNjgtMS41NTMtNC4wNTktMS4wMzUtLjk5LTIuMzM4LTEuNDg1LTMuODg2LTEuNDg1LTEuNTA1IDAtMi43ODMuNDk1LTMuODQzIDEuNDg1LTEuMDYgMS0xLjU5MSAyLjM0My0xLjU5MSA0LjA1OVpNODQuMzQ2IDIuNzQ2aDEuNzM4VjIzLjQxNGMwIDEuMzc5LjM1NSAyLjQ1IDEuMDY2IDMuMjE2LjcxMS43NjYgMS42MTUgMS4xNSIvPg0KPHBhdGggZmlsbD0iI0ZGRDEwMCIgZD0iTTMxLjE5MiAxMi4xMTJsMS40MTQtMS40MTMgMy41ODYgMy41ODYgMS40MTQtMS40MTQtMy41ODYtMy41ODYgMS40MTQtMS40MTQtMy41ODYtMy41ODZhLjk5Ni45OTYgMCAwIDAtMS40MTQgMGwtMS40MTQgMS40MTMgMy41ODYgMy41ODYtMS40MTQgMS40MTMgMy41ODYgMy41ODZ6Ii8+DQo8L3N2Zz4=" alt="eTwinning Logosu" class="h-6 opacity-80">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMwIiB2aWV3Qm94PSIwIDAgMTAwIDMwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiMwMDkzZGEiIGQ9Ik0zMi4wMzIgMTIuMjk1SDIyLjk0bDMuOTc3IDMuOTc3di4wMDFoNS4xMTV2LTMuOTc4Wm0wIDUuMTJIMUMxLjgyNCAxLjEyIDIuODcyIDEuNTkgMy43MjggMi4zN2guMDJjLjk1Ny43OCAxLjU3IDEuODQgMi4xMDcgMy4xNTNsLjAwNS4wMTJjLjUzOCAxLjMxMy44MDYgMi43OC44MDYgNC40VjI3LjI1NWgtMS43MzhWMjMuNDE0Yy4wMDEtMS4zNzktLjM1NC0yLjQ1LTEuMDY1LTMuMjE2LS43MS0uNzY2LTEuNjE0LTEuMTUtMi43MDgtMS4xNUg4MC4zVjI3LjI1NGgtMS43MzhWOS45NmMwLTEuNzMzLjIyLTMuMjU3LjY1Ny00LjU3NC40MzYtMS4zMTcuOTk3LTIuNDI1IDEuNjgxLTMuMzI1IDEuMzU3LTEuNzU4IDMuMDc5LTIuNjM3IDUuMTY2LTIuNjM3IDEuOTk3IDAgMy42MzUuNzggNC45MTUgMi4zNHMxLjkxOSAzLjQ4MyAxLjkxOSA1Ljc3MnYxMi45MDFoLTEuNzM4di0xLjQ4NmMtMS4yNjYgMS4xOTUtMi43ODMgMS43OTMtNC41NSAxLjc5My0yLjEyIDAtMy45MS0uODctNS4zNzMtMi42MS0xLjQ2My0xLjc0LTEuNjY3LTMuNjQzLTEuNjY3LTUuNzA5IDAtMi4wNjYuMjA0LTMuOTczIDEuNjY3LTUuNzA5IDEuNDYzLTEuNzQgMy4yNTMtMi42MSA1LjM3My0yLjYxIDEuNzY3IDAgMy4yODMuNjAzIDQuNTUgMS43OTNWMTEuMTRjMC0yLjI4OS0uNjQzLTMuOTk3LTEuOTE5LTUuNzcyWk05NC4wMiAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1YyAxLjQzMiAxLjM3MiAyLjE0OCAzLjE3NyAyLjE0OCA1LjQxNSAwIDIuEzk3LS43MTYgMy45OTctMi4xNDggNS40cy0zLjAzIDIuMS00LjgxIDIuMWMtMS43IDAtMy4yNTctLjY5LTQuNjctMi4wNjlWMjcuMjU0aC0xLjczOFYyLjc0NmgxLjczOHY2Ljg1NlpNOTQuNjkgOS4xOWMwIDEuNzU4LjUzIDMuMTE4IDEuNTkxIDQuMDc5IDEuMDYuOTYgMi4zMzggMS40NCAzLjg0MyAxLjQ0IDEuNTQ4IDAgMi44NTEtLjQ4IDMuODg2LTEuNDQgMS4wMzUtLjk2IDEuNTUzLTIuMzIgMS41NTMtNC4wNzkgMC0xLjcxNi0uNTE4LTMuMDY4LTEuNTUzLTQuMDU5LTEuMDM1LTUuOTktMi4zMzgtMS40ODUtMy44ODYtMS40ODUtMS41MDUgMC0yLjc4My40OTUtMy44NDMgMS40ODUtMS4wNiAxLTEuNTkxIDIuMzQzLTEuNTkxIDQuMDU5WiIvPjxwYXRoIGZpbGw9IiMwMDkzZGEiIGQ9Ik0xOC40ODUgMTUuMDA4aDEuNDU2YTcuMDIgNy4wMiAwIDAgMCAzLjQ5OC0xLjA5NSA0LjQ4OSA0LjQ4OSAwIDAgMCAyLjQ1NC0zLjA4OCA0LjI4MiA0LjI4MiAwIDAgMC0xLjQ4OS00LjMzNCA1LjAxMiA1LjAxMiAwIDAgMC0zLjgyMS0xLjQ2OUgxOC40ODV2OS45ODYxWm0tMy4xNzcgOS4zMDVIMTUuMzA4VjMuOTY5aDUuMTc3YzEuNzYgMCAzLjMwNS4zNzkgNC43MzMgMS4xMzkgMS40MjcuNzU5IDIuNTcgMS44NzQgMy40MjggMy4zNDQgLjg1OCAxLjQ2OSAxLjI4NyAzLjE2IDEuMjg3IDUuMDc0IDAgMS42MTUtLjMyNSAzLjEyMy0uOTc0IDQuNTE4YTcuMDY5IDcuMDY5IDAgMCAxLTIuNjU3IDMuMTk4IDcuOTQxIDcuOTQxIDAgMCAxLTQgMS4zMDJINC4xMTRsMy4yMDggMy4yMDhoMy45ODd2LTguNDE1aC0zLjk4N2wtMy4yMDggMy4yMDhINC4xMTRsMy4yMDggMy4yMDh6TTIuNzU2IDE1LjAwOGgxLjQ1NmE3LjAyIDcuMDIgMCAwIDAgMy40OTgtMS4wOTUgNC40ODkgNC40ODkgMCAwIDAgMi40NTQtMy4wODggNC4yODIgNC4yODIgMCAwIDAtMS40ODktNC4zMzQgNS4wMTIgNS4wMTIgMCAwIDAtMy44MTEtMS40NjlIMi43NTZ2OS45ODYxWk0tLjQyIDI0LjMxM2gxNS43MjlWMy45NjloNS4xNzdjMS43NiAwIDMuMzA1LjM3OSA0LjczMyAxLjEzOSAxLjQyNy43NTkgMi41NyAxLjg3NCAzLjQyOCAzLjM0NCAuODU4IDEuNDY5IDEuMjg3IDMuMTYgMS4yODcgNS4wNzQgMCAxLjYxNS0uMzI1IDMuMTIzLS45NzQgNC41MThhNy4wNjkgNy4wNjkgMCAwIDEtMi4yNTcgMy4xOTggNy45NDEgNy45NDEgMCAwIDEtNCAxLjMwMkgtLjQxOHoiLz48L3N2Zz4=" alt="CodeWeek Logosu" class="h-8 opacity-80">
                </div>
            </div>
        </div>

        <!-- Başlık ve Kullanıcı Bilgisi -->
        <header class="header-blue text-white p-4 shadow-lg sticky top-0 z-20">
            <div class="flex justify-between items-center">
                <div class="flex items-center flex-wrap"> 
                    <h1 class="text-base sm:text-xl font-bold flex items-center mr-3"> 
                        <svg class="w-6 h-6 mr-2 text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9h-9m-9 0a9 9 0 019-9m-9 9h6m-9 9a9 9 0 019-9m-9 9a9 9 0 009 9m9-9a9 9 0 01-9 9m9-9h-9m-9 0a9 9 0 019-9m-9 9h6"></path></svg>
                        <span data-i18n="app_main_title">STEMCycle G2B Lab Hub</span>
                    </h1>
                    <span class="text-sm font-light italic pl-3 border-l border-green-200 hidden sm:inline-block sm:align-middle">BluEcoInVET</span>
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMwIiB2aWV3Qm94PSIwIDAgMTAwIDMwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiMwMDQ0OTQiIGQ9Ik0wIDIuNzQ2aDEuNzM4VjI3LjI1NEDgwVjIuNzQ2ek0zLjI3IDIuNzQ2aDQuMDQ4YzIuODEgMCA0LjM2OC41MyA1LjY3NSAyLjE5NyAxLjMwNSAxLjY2NyAxLjk1OCAzLjg2NyAxLjk1OCA2LjYwMiAwIDIuNzM0LS42NTMgNC45MzQtMS45NTggNi42MDItMS4zMDcuMTY2Ny0yLjg2NSAyLjE5Ny01LjY3NSAyLjE5N0gzLjI3VjIuNzQ2Wm0xLjc0IDYuMDYydjcuMjNoMi4zMDhjMi4wMSAwIDIuOTI4LS44MjIgMi45MjgtMi4yNzOTIgMC0yLjA1My0uOTE5LTIuNzUzLTIuNzgtMi43NTNINS4wMXpNMTUuODQ4IDIuNzQ2aDQuMDQ4YzIuODEgMCA0LjM2OC41MyA1LjY3NSAyLjE5NyAxLjMwNSAxLjY2NyAxLjk1OCAzLjg2NyAxLjk1OCA2LjYwMiAwIDIuNzM0LS42NTMgNC45MzQtMS45NTggNi42MDItMS4zMDcuMTY2Ny0yLjg2NSAyLjE5Ny01LjY3NSAyLjE5N0gxNS44NThWMi43NDZabTEuNzQgNi4wNjJ2Ny4yM2gyLjMwOGMyLjAxIDAgMi45MjgtLjgyMiAyLjkyOC0yLjc5MiAwLTIuMDUzLS45MTktMi43NTMtMi43OC0yLjc1M2gtMi4xNDhaTTI4LjQyNyAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1IDQuODEgMi4wNTcgMS40MzIgMS4zNzIgMi4xNDggMy4xNzcgMi4xNDggNS40MTUgMCAyLjE5Ny0uNzE2IDMuOTk3LTIuMTQ4IDUuNHMtMy4wMyAyLjEtNC44MSAyLjFjLTEuNyAwLTMuMjU3LS42OS00LjY3LTIuMDY5VjI3LjI1NGgtMS43MzhWMi43NDZoMS43Mzh2Ni44NTZaTTMzLjA5NyA5LjE5YzAgMS43NTguNTMgMy4xMTggMS41OTEgNC4wNzkgMS4wNi45NiAyLjMzOCAxLjQ0IDMuODQzIDEuNDQgMS41NDggMCAyLjg1MS0uNDggMy44ODYtMS40NCAxLjAzNS0uOTYgMS41NTMtMi4zMiAxLjU1My00LjA3OSAwLTEuNzE2LS41MTgtMy4wNjgtMS41NTMtNC4wNTktMS4wMzUtLjk5LTIuMzM4LTEuNDg1LTMuODg2LTEuNDg1LTEuNTA1IDAtMi43ODMuNDk1LTMuODQzIDEuNDg1LTEuMDYgMS0xLjU5MSAyLjM0My0xLjU5MSA0LjA1OVpNNTAuMTI3IDIuNzQ2aDMuMjE2bC0zLjAzIDkuMzE4LTUuNjU0LTkuMzE4aC0zLjU2M2w3LjIzIDExLjk0Ny43NDIgMS4yMzVoLTEuNjQxbC0xLjk3OS0zLjI2aC0uOTM4bC0uODk2IDEuNDI3IDIuMTEyIDMuNDkzaDMuMzIzbDYuOTI0LTExLjQwM2gxLjc2bC01LjUyIDkuMDg4IDQuMzY4IDcuMTY4aC0zLjMyMmwtMi44NzctNC4yMTUtMS41MzEgMi41MmgxLjQ2N2wuODI4IDEuMzY4aC45NThsLjY3OCAxLjExNGgtNy45NjhsLjY3OC0xLjExNGguOTU4bC44MjgtMS4zNjhoMS40NjdMNDEuNiAyNy4yNTRsLTUuNzgtOS45MjVMODAuMDM0IDIuNzQ2aC0uNjU2bC01LjY1MyA5LjMxOEw2OC4wNDQgMi43NDZoLTMuMjE2bDQuNjkyIDcuNzYyIDQuNDUtNy43NjJoMy41NjNsLTcuMjMgMTEuOTQ3LS43NDIgMS4yMzVoMS42NDFsMS45OC0zLjI2aC45MzhsLjg5NiAxLjQyNy0yLjExMiAzLjQ5M2gtMy4zMjNMNTguMyAxNS44NGwtNi45MjQtMTEuNDAzaC0xLjc2bDUuNTIgOS4wODgtNC4zNjggNy4xNjhoMy4zMjJsMi44NzctNC43MTUgMS41MzIgMi41MmgtMS40NjdsLS44MjggMS4zNjhoLS45NThsLS42NzgtMS4xMTRoNy45NjhMNTkuMzU4IDI3LjI1NGw1Ljc4LTkuNTI1IDQuNjQ2IDcuNTI1aC42NTZaTTY5LjEyNyAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1IDQuODEgMi4wNTcgMS40MzIgMS4zNzIgMi4xNDggMy4xNzcgMi4xNDggNS40MTUgMCAyLjE5Ny0uNzE2IDMuOTk3LTIuMTQ4IDUuNHMtMy4wMyAyLjEtNC44MSAyLjFjLTEuNyAwLTMuMjU3LS42OS00LjY3LTIuMDY5VjI3LjI1NGgtMS43MzhWMi43NDZoMS43Mzh2Ni44NTZaTTczLjc5NyA5LjE5YzAgMS43NTguNTMgMy4xMTggMS41OTEgNC4wNzkgMS4wNi45NiAyLjMzOCAxLjQ0IDMuODQzIDEuNDQgMS41NDggMCAyLjg1MS0uNDggMy44ODYtMS40NCAxLjAzNS0uOTYgMS41NTMtMi4zMiAxLjU1My00LjA3OSAwLTEuNzE2LS41MTgtMy4wNjgtMS41NTMtNC4wNTktMS4wMzUtLjk5LTIuMzM4LTEuNDg1LTMuODg2LTEuNDg1LTEuNTA1IDAtMi43ODMuNDk1LTMuODQzIDEuNDg1LTEuMDYgMS0xLjU5MSAyLjM0My0xLjU5MSA0LjA1OVpNODQuMzQ2IDIuNzQ2aDEuNzM4VjIzLjQxNGMwIDEuMzc5LjM1NSAyLjQ1IDEuMDY2IDMuMjE2LjcxMS43NjYgMS42MTUgMS4xNSIvPg0KPHBhdGggZmlsbD0iI0ZGRDEwMCIgZD0iTTMxLjE5MiAxMi4xMTJsMS40MTQtMS40MTMgMy41ODYgMy41ODYgMS40MTQtMS40MTQtMy41ODYtMy41ODYgMS40MTQtMS40MTQtMy41ODYtMy41ODZhLjk5Ni45OTYgMCAwIDAtMS40MTQgMGwtMS40MTQgMS40MTMgMy41ODYgMy41ODYtMS40MTQgMS40MTMgMy41ODYgMy41ODZ6Ii8+DQo8L3N2Zz4=" alt="eTwinning Logosu" class="header-logo hidden sm:inline-block">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjMwIiB2aWV3Qm94PSIwIDAgMTAwIDMwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiMwMDkzZGEiIGQ9Ik0zMi4wMzIgMTIuMjk1SDIyLjk0bDMuOTc3IDMuOTc3di4wMDFoNS4xMTV2LTMuOTc4Wm0wIDUuMTJIMUMxLjgyNCAxLjEyIDIuODcyIDEuNTkgMy43MjggMi4zN2guMDJjLjk1Ny43OCAxLjU3IDEuODQgMi4xMDcgMy4xNTNsLjAwNS4wMTJjLjUzOCAxLjMxMy44MDYgMi43OC44MDYgNC40VjI3LjI1NWgtMS43MzhWMjMuNDE0Yy4wMDEtMS4zNzktLjM1NC0yLjQ1LTEuMDY1LTMuMjE2LS43MS0uNzY2LTEuNjE0LTEuMTUtMi43MDgtMS4xNUg4MC4zVjI3LjI1NGgtMS43MzhWOS45NmMwLTEuNzMzLjIyLTMuMjU3LjY1Ny00LjU3NC40MzYtMS4zMTcuOTk3LTIuNDI1IDEuNjgxLTMuMzI1IDEuMzU3LTEuNzU4IDMuMDc5LTIuNjM3IDUuMTY2LTIuNjM3IDEuOTk3IDAgMy42MzUuNzggNC45MTUgMi4zNHMxLjkxOSAzLjQ4MyAxLjkxOSA1Ljc3MnYxMi45MDFoLTEuNzM4di0xLjQ4NmMtMS4yNjYgMS4xOTUtMi43ODMgMS43OTMtNC41NSAxLjc5My0yLjEyIDAtMy45MS0uODctNS4zNzMtMi42MS0xLjQ2My0xLjc0LTEuNjY3LTMuNjQzLTEuNjY3LTUuNzA5IDAtMi4wNjYuMjA0LTMuOTczIDEuNjY3LTUuNzA5IDEuNDYzLTEuNzQgMy4yNTMtMi42MSA1LjM3My0yLjYxIDEuNzY3IDAgMy4yODMuNjAzIDQuNTUgMS43OTNWMTEuMTRjMC0yLjI4OS0uNjQzLTMuOTk3LTEuOTE5LTUuNzcyWk05NC4wMiAyLjM0N2MxLjQxMy0xLjM4IDIuOTctMi4wNyA0LjY3LTIuMDcgMS43OCAwIDMuMzguNjg1YyAxLjQzMiAxLjM3MiAyLjE0OCAzLjE3NyAyLjE0OCA1LjQxNSAwIDIuEzk3LS43MTYgMy45OTctMi4xNDggNS40cy0zLjAzIDIuMS00LjgxIDIuMWMtMS43IDAtMy4yNTctLjY5LTQuNjctMi4wNjlWMjcuMjU0aC0xLjczOFYyLjc0NmgxLjczOHY2Ljg1NlpNOTQuNjkgOS4xOWMwIDEuNzU4LjUzIDMuMTE4IDEuNTkxIDQuMDc5IDEuMDYuOTYgMi4zMzggMS40NCAzLjg0MyAxLjQ0IDEuNTQ4IDAgMi44NTEtLjQ4IDMuODg2LTEuNDQgMS4wMzUtLjk2IDEuNTUzLTIuMzIgMS41NTMtNC4wNzkgMC0xLjcxNi0uNTE4LTMuMDY4LTEuNTUzLTQuMDU5LTEuMDM1LTUuOTktMi4zMzgtMS40ODUtMy44ODYtMS40ODUtMS41MDUgMC0yLjc4My40OTUtMy44NDMgMS40ODUtMS4wNiAxLTEuNTkxIDIuMzQzLTEuNTkxIDQuMDU5WiIvPjxwYXRoIGZpbGw9IiMwMDkzZGEiIGQ9Ik0xOC40ODUgMTUuMDA4aDEuNDU2YTcuMDIgNy4wMiAwIDAgMCAzLjQ5OC0xLjA5NSA0LjQ4OSA0LjQ4OSAwIDAgMCAyLjQ1NC0zLjA4OCA0LjI4MiA0LjI4MiAwIDAgMC0xLjQ4OS00LjMzNCA1LjAxMiA1LjAxMiAwIDAgMC0zLjgyMS0xLjQ2OUgxOC40ODV2OS45ODYxWm0tMy4xNzcgOS4zMDVIMTUuMzA4VjMuOTY5aDUuMTc3YzEuNzYgMCAzLjMwNS4zNzkgNC43MzMgMS4xMzkgMS40MjcuNzU5IDIuNTcgMS44NzQgMy40MjggMy4zNDQgLjg1OCAxLjQ2OSAxLjI4NyAzLjE2IDEuMjg3IDUuMDc0IDAgMS42MTUtLjMyNSAzLjEyMy0uOTc0IDQuNTE4YTcuMDY5IDcuMDY5IDAgMCAxLTIuNjU3IDMuMTk4IDcuOTQxIDcuOTQxIDAgMCAxLTQgMS4zMDJINC4xMTRsMy4yMDggMy4yMDhoMy45ODd2LTguNDE1aC0zLjk4N2wtMy4yMDggMy4yMDhINC4xMTRsMy4yMDggMy4yMDh6TTIuNzU2IDE1LjAwOGgxLjQ1NmE3LjAyIDcuMDIgMCAwIDAgMy40OTgtMS4wOTUgNC40ODkgNC40ODkgMCAwIDAgMi40NTQtMy4wODggNC4yODIgNC4yODIgMCAwIDAtMS40ODktNC4zMzQgNS4wMTIgNS4wMTIgMCAwIDAtMy44MTEtMS40NjlIMi43NTZ2OS45ODYxWk0tLjQyIDI0LjMxM2gxNS43MjlWMy45NjloNS4xNzdjMS43NiAwIDMuMzA1LjM3OSA0LjczMyAxLjEzOSAxLjQyNy43NTkgMi41NyAxLjg3NCAzLjQyOCAzLjM0NCAuODU4IDEuNDY5IDEuMjg3IDMuMTYgMS4yODcgNS4wNzQgMCAxLjYxNS0uMzI1IDMuMTIzLS45NzQgNC41MThhNy4wNjkgNy4wNjkgMCAwIDEtMi4yNTcgMy4xOTggNy45NDEgNy45NDEgMCAwIDEtNCAxLjMwMkgtLjQxOHoiLz48L3N2Zz4=" alt="CodeWeek Logosu" class="header-logo codeweek hidden sm:inline-block"> 
                </div>
                <div class="flex items-center space-x-4"><select id="language-select" class="bg-white text-gray-800 text-xs font-semibold p-1 rounded-md cursor-pointer" onchange="changeLanguage(this.value)"><option value="tr">TR</option><option value="en">EN</option></select><div class="text-sm"><p id="user-info" class="font-semibold text-right truncate"></p><p id="user-location" class="text-xs opacity-70 truncate"></p></div></div>
            </div>
        </header>

        <!-- Sekmeler -->
        <nav class="bg-white shadow-md p-2 flex justify-around text-gray-600 sticky top-[68px] z-20 overflow-x-auto whitespace-nowrap">
             <button id="tab-groups" onclick="changeTab('groups-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0 tab-active" data-i18n="tab_groups">Gruplar & Harita</button>
             <button id="tab-files" onclick="changeTab('files-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0" data-i18n="tab_files">Proje Dosyaları</button>
             <button id="tab-announcements" onclick="changeTab('announcements-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0" data-i18n="tab_announcements">Duyurular</button>
             <button id="tab-gallery" onclick="changeTab('gallery-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0" data-i18n="tab_gallery">Dijital Sergi</button>
             <button id="tab-lab" onclick="changeTab('lab-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0" data-i18n="tab_lab">Simülasyon Lab</button>
             <button id="tab-module" onclick="changeTab('module-view')" class="tab-button px-2 py-2 text-xs sm:text-sm flex-shrink-0" data-i18n="tab_module">
                <svg class="w-5 h-5 inline-block sm:mr-1 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 10-4 0v1a2 2 0 004 0V4zM19 4a2 2 0 10-4 0v1a2 2 0 004 0V4zM7 20h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v11a2 2 0 002 2z"></path></svg>
                Modül
            </button>
        </nav>

        <!-- Ana İçerik Alanı -->
        <main class="flex-grow p-4 space-y-6 z-10 relative">
             <!-- Gruplar Sekmesi (YENİ GRID DÜZENİ) -->
             <section id="groups-view" class="tab-content grid grid-cols-1 lg:grid-cols-3 gap-6">
                 <!-- Sol Sütun: Grup Yönetimi ve Listesi -->
                 <div class="lg:col-span-2 space-y-6">
                     <div class="bg-white p-4 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="create_join_group_title">Grup Oluştur / Katıl</h2><input type="text" id="new-group-name" placeholder="Yeni Grup Adı" class="w-full p-2 border rounded-lg mb-3"><div class="mb-4"><label class="block text-sm font-medium" data-i18n="project_focus_label">Odak:</label><div class="flex space-x-4"><label><input type="radio" name="economyFocus" value="Mavi" checked> <span data-i18n="focus_blue">Mavi Ekonomi</span></label><label><input type="radio" name="economyFocus" value="Yeşil"> <span data-i18n="focus_green">Yeşil Ekonomi</span></label></div></div><button onclick="createGroup()" class="w-full accent-blue bg-blue-600 text-white py-2 rounded-lg font-semibold flex items-center justify-center" data-original-text="<svg class='w-5 h-5 mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4v16m8-8H4'></path></svg><span>Grup Oluştur</span>" data-i18n="create_group_btn"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4v16m8-8H4'></path></svg><span>Grup Oluştur</span></button></div>
                     <div id="all-groups-list" class="space-y-4"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="all_groups_title">Tüm Gruplar</h2><p class="text-gray-500 text-center py-4" data-i18n="loading_all_groups">Gruplar yükleniyor...</p></div>
                 </div>
                 <!-- Sağ Sütun: Harita, Hava Durumu, Aktif Kullanıcılar -->
                 <div class="lg:col-span-1 space-y-6">
                     <div class="bg-white p-4 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="map_title">Etki Haritası</h2><div id="user-map"></div></div>
                     <div id="weather-card" class="bg-gradient-to-br from-blue-500 to-blue-700 text-white p-4 rounded-xl shadow-lg hidden"><h3 class="font-bold text-lg mb-3 border-b border-blue-300 pb-2" data-i18n="weather_title">Konum İklim Verisi</h3><div id="weather-content" class="mt-4"><p id="weather-loading" class="text-center text-blue-100" data-i18n="weather_loading">Hava durumu verisi yükleniyor...</p></div></div>
                     <div class="bg-white p-4 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="active_users_title">Aktif Kullanıcılar</h2><div id="all-users-list" class="space-y-2 max-h-64 overflow-y-auto"><p class="text-gray-400 text-xs italic p-2">Yükleniyor...</p></div></div>
                 </div>
             </section>
             <!-- Diğer Sekmeler (Files, Announcements, Gallery, Lab, Module) -->
              <section id="files-view" class="tab-content hidden"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="upload_file_title">Proje Dosyası Yükle</h2><div class="mb-4"><label for="group-select-upload" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="select_group_label">Hangi grup için yüklüyorsunuz?</label><select id="group-select-upload" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue"><option value="" data-i18n="select_group_default">Önce bir grup seçin...</option></select></div><div class="mb-4"><label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="file_type_label">Dosya Tipi:</label><div class="flex space-x-4"><label class="inline-flex items-center"><input type="radio" name="fileType" value="data" checked class="form-radio text-accent-blue" onchange="toggleFileInput('data')"><span class="ml-2" data-i18n="file_type_data">Veri</span></label><label class="inline-flex items-center"><input type="radio" name="fileType" value="image" class="form-radio text-accent-blue" onchange="toggleFileInput('image')"><span class="ml-2" data-i18n="file_type_image">Görsel</span></label><label class="inline-flex items-center"><input type="radio" name="fileType" value="code" class="form-radio text-accent-blue" onchange="toggleFileInput('code')"><span class="ml-2" data-i18n="file_type_code">Kod</span></label></div></div><div id="file-drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-accent-blue hover:bg-gray-50 transition"><input type="file" id="file-input" class="hidden" multiple><p class="text-gray-500" data-i18n="drag_drop_text">Dosyaları buraya sürükleyin veya seçin.</p><p id="file-drop-feedback" class="text-sm text-gray-600 mt-2"></p></div><button onclick="uploadFile()" class="w-full accent-blue text-white py-2 rounded-lg font-semibold mt-4 hover:bg-blue-600 transition" data-original-text="<svg class='w-5 h-5 inline-block mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12'></path></svg> Yükle" data-i18n="upload_btn"><svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>Yükle</button></div><div class="bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="uploaded_files_title">Yüklenen Dosyalar</h2><div class="mb-4"><label for="group-select-view" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="filter_by_group_label">Gruba Göre Filtrele:</label><select id="group-select-view" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue" onchange="displayGroupFiles(this.value)"><option value="" data-i18n="select_group_default">Önce bir grup seçin...</option></select></div><div id="file-list-container" class="space-y-3 max-h-96 overflow-y-auto"><p class="text-gray-500 text-center" data-i18n="no_group_selected_files">Dosyaları görmek için grup seçin.</p></div></div></div></section>
             <section id="announcements-view" class="tab-content hidden"><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div id="add-announcement-ui" class="md:col-span-1 bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="add_announcement_title">Yeni Duyuru Ekle</h2><div class="space-y-4"><input type="text" id="announcement-title" placeholder="Duyuru Başlığı" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue" data-i18n-placeholder="announcement_title_placeholder"><textarea id="announcement-content" placeholder="Duyuru içeriği..." rows="5" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-accent-blue focus:border-accent-blue" data-i18n-placeholder="announcement_content_placeholder"></textarea><button onclick="publishAnnouncement()" class="w-full accent-blue text-white py-2 rounded-lg font-semibold hover:bg-blue-600 transition" data-original-text="<svg class='w-5 h-5 inline-block mr-2' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.144-6.124A1.76 1.76 0 015.5 12.118l6.195-2.23A1.76 1.76 0 0113.6 11.4l1.24 7.27a1.76 1.76 0 01-3.51.275l-.94-5.524Z'></path></svg> Yayınla" data-i18n="publish_btn"><svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.144-6.124A1.76 1.76 0 015.5 12.118l6.195-2.23A1.76 1.76 0 0113.6 11.4l1.24 7.27a1.76 1.76 0 01-3.51.275l-.94-5.524Z'></path></svg>Yayınla</button></div></div><div class="md:col-span-2 bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="announcements_title">Duyurular</h2><div id="announcement-list" class="space-y-4 max-h-[500px] overflow-y-auto"><p class="text-gray-500 text-center" data-i18n="loading_announcements">Duyurular yükleniyor...</p></div></div></div></section>
             <section id="gallery-view" class="tab-content hidden"><div class="bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="gallery_title">Dijital Sergi</h2><p class="mb-4 text-gray-600" data-i18n="gallery_desc">Projelerin görselleri ve veri çıktıları burada sergilenir.</p><div class="flex space-x-4 mb-4"><label class="inline-flex items-center"><input type="radio" name="galleryFilter" value="all" checked class="form-radio text-accent-blue" onchange="renderFiles(true)"><span class="ml-2" data-i18n="filter_all">Tümü</span></label><label class="inline-flex items-center"><input type="radio" name="galleryFilter" value="image" class="form-radio text-accent-blue" onchange="renderFiles(true)"><span class="ml-2" data-i18n="filter_images">Görseller</span></label><label class="inline-flex items-center"><input type="radio" name="galleryFilter" value="data" class="form-radio text-accent-blue" onchange="renderFiles(true)"><span class="ml-2" data-i18n="filter_data">Veri</span></label></div><div id="gallery-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"><p class="text-gray-500" data-i18n="loading_gallery">Yükleniyor...</p></div></div></section>
             <section id="lab-view" class="tab-content hidden"><div class="bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="lab_title">Simülasyon Lab</h2><p class="mb-4 text-gray-600" data-i18n="lab_desc">Modülleri birleştirerek sürdürülebilir sisteminizi tasarlayın.</p><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div class="md:col-span-1 bg-gray-50 p-4 rounded-lg border"><h3 class="font-semibold mb-3" data-i18n="lab_kit_title">Modül Çantası</h3><div class="space-y-3"><div data-module-id="blue-1" data-module-name="Deniz Yosunu Çiftliği" class="lab-module p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg shadow-sm"><strong data-i18n="module_blue_1_name">🌊 Deniz Yosunu Çiftliği</strong><p class="text-xs" data-i18n="module_blue_1_desc">G: CO2, Güneş | Ç: Biyokütle, O2</p></div><div data-module-id="blue-2" data-module-name="Dalga Enerjisi" class="lab-module p-3 bg-blue-100 border border-blue-300 text-blue-800 rounded-lg shadow-sm"><strong data-i18n="module_blue_2_name">⚡ Dalga Enerjisi</strong><p class="text-xs" data-i18n="module_blue_2_desc">G: Dalga | Ç: Enerji</p></div><div data-module-id="green-1" data-module-name="Güneş Paneli" class="lab-module p-3 bg-green-100 border border-green-300 text-green-800 rounded-lg shadow-sm"><strong data-i18n="module_green_1_name">☀️ Güneş Paneli</strong><p class="text-xs" data-i18n="module_green_1_desc">G: Güneş | Ç: Enerji</p></div><div data-module-id="green-2" data-module-name="Kompost Tesisi" class="lab-module p-3 bg-green-100 border border-green-300 text-green-800 rounded-lg shadow-sm"><strong data-i18n="module_green_2_name">♻️ Kompost Tesisi</strong><p class="text-xs" data-i18n="module_green_2_desc">G: Biyokütle | Ç: Gübre</p></div><div data-module-id="connector" data-module-name="Bağlayıcı" class="lab-module p-2 bg-gray-200 border border-gray-400 text-gray-700 rounded-lg shadow-sm text-center"><strong data-i18n="module_connector">🔗 Bağlayıcı</strong></div></div></div><div class="md:col-span-3 h-[500px] relative rounded-lg overflow-hidden" id="lab-canvas-container"><div id="lab-canvas" class="w-full h-full relative border-2 border-dashed border-gray-300 bg-gray-50 rounded-lg"></div></div></div><div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"><div class="flex items-center space-x-2 flex-wrap gap-2"><button onclick="runLabSimulation()" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700" data-i18n="lab_run_btn">Başlat</button><button onclick="clearKitCanvas()" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600" data-i18n="lab_clear_btn">Temizle</button><input type="text" id="kit-name" placeholder="Kit Adı" class="p-2 border rounded-lg flex-grow" data-i18n-placeholder="kit_name_placeholder"><button onclick="saveKitCanvas()" class="px-4 py-2 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600" data-i18n="lab_save_btn">Kaydet</button><select id="saved-kits-dropdown" class="p-2 border rounded-lg" onchange="loadSavedKit(this.value)"><option value="" data-i18n="lab_load_default">Yükle</option></select></div><div class="bg-gray-100 p-4 rounded-lg border"><h3 class="font-semibold mb-2" data-i18n="lab_results_title">LAB Sonuçları</h3><pre id="lab-output" class="text-sm text-gray-700 font-mono overflow-y-auto h-24" data-i18n="lab_results_placeholder">Sonuçlar burada...</pre></div></div></div></section>
             <section id="module-view" class="tab-content hidden"><div class="bg-white p-5 rounded-xl shadow-lg"><h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2" data-i18n="module_dev_title">Modül Geliştirme</h2><p class="mb-4 text-gray-600" data-i18n="module_dev_desc">Kendi modülünüzü tasarlayın.</p><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-4"><input type="text" id="module-name" placeholder="Modül Adı" class="w-full p-2 border rounded-lg" data-i18n-placeholder="module_name_placeholder"><input type="text" id="module-input" placeholder="Girdi" class="w-full p-2 border rounded-lg" data-i18n-placeholder="module_input_placeholder"><input type="text" id="module-output" placeholder="Çıktı" class="w-full p-2 border rounded-lg" data-i18n-placeholder="module_output_placeholder"><select id="module-type" class="w-full p-2 border rounded-lg"><option value="blue" data-i18n="module_type_blue">Mavi Ekonomi</option><option value="green" data-i18n="module_type_green">Yeşil Ekonomi</option><option value="other" data-i18n="module_type_other">Diğer</option></select><button onclick="createCustomModule()" class="w-full accent-green text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition" data-i18n="module_add_btn">Ekle</button></div><div class="bg-gray-50 p-4 rounded-lg border max-h-64 overflow-y-auto"><h3 class="font-semibold mb-3" data-i18n="custom_modules_title">Geliştirilenler</h3><div id="custom-modules-list" class="space-y-2"><p class="text-gray-500 text-sm" data-i18n="no_custom_modules">Özel modül yok.</p></div></div></div></div></section>
        </main>
        
        <footer class="bg-gray-100 p-3 text-xs text-gray-600 text-center mt-auto z-10 relative"><p data-i18n="project_desc">Bu platform, su okuryazarlığı ile yeşil ve mavi ekonomi arasındaki ilişkiyi göstermeyi amaçlar.</p></footer>
    </div>

    <div id="message-box" class="fixed bottom-4 right-4 bg-red-500 text-white p-3 rounded-lg shadow-xl hidden z-50"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, deleteDoc, updateDoc, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        
        const translations = { /* ... Çeviri metinleri (weather_ çevirileri dahil) ... */ };
        let app, db, auth, storage;
        let userId = null, userName = '', userSchool = '', userEmail = '', isGuest = true;
        let userLat = null, userLon = null;
        let userGroups = [], allUserMetadata = [], groupMap = {}; 
        let userMap = null, mapMarkers = []; 
        let isMapInitialized = false;
        let usersUnsubscribe, groupsUnsubscribe, announcementsUnsubscribe, panelsUnsubscribe; // Dinleyici referansları
        let filesListener, labDataListener; // Sekmeye özel dinleyiciler

        const firebaseConfig = {
            apiKey: "AIzaSyAshVa6zGftQmBQcjo_HRHoOP92vb3kKgQ",
            authDomain: "stemcycle-g2b-innovation-efe5c.firebaseapp.com",
            projectId: "stemcycle-g2b-innovation-efe5c",
            storageBucket: "stemcycle-g2b-innovation-efe5c.appspot.com",
            appId: "1:79339752913:web:5379abf2794791b7bda4f0"
        };
        
        // --- Genel Fonksiyonlar ---
        function showMessage(message, isError = false) { /* ... */ }
        
        window.changeTab = (tabId) => {
             document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
             document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'tab-active')); 
             const activeContent = document.getElementById(tabId);
             // Buton ID'si tabId'den türetilirken '-view' kısmını kaldırıyoruz
             const buttonIdPrefix = tabId.replace('-view', ''); 
             const activeButtonId = `tab-${buttonIdPrefix}`; 
             const activeButton = document.getElementById(activeButtonId);

             if (activeContent) activeContent.classList.remove('hidden');
             // Buton bulunamazsa hata vermemesi için kontrol eklendi
             if (activeButton) activeButton.classList.add('active', 'tab-active'); 
             else console.warn(`Button with ID ${activeButtonId} not found.`);

             // HARİTA YENİDEN BOYUTLANDIRMA MANTIĞI
             if (tabId === 'groups-view') {
                 // Sekme görünür hale geldikten *sonra* haritayı başlat veya boyutlandır
                 // RequestAnimationFrame DOM'un boyama yapmasını bekler, daha güvenilir
                 requestAnimationFrame(() => { 
                     if (!isMapInitialized) {
                         console.log("Initializing map on tab change...");
                         initializeMap(); 
                     } else if (userMap) {
                         console.log("Invalidating map size on tab change.");
                         // Haritanın düzgün boyutlandırılmasını sağlamak için tekrar gecikme
                         setTimeout(() => { 
                             if(userMap) userMap.invalidateSize(); 
                             console.log("Map size invalidated.");
                         }, 100); 
                     }
                 }); 
             }
         }

        // --- Başlangıç ve Kimlik Doğrulama ---
        async function initializeFirebase() {
             try {
                 if (!app) {
                     app = initializeApp(firebaseConfig); 
                     db = getFirestore(app);
                     auth = getAuth(app);
                     storage = getStorage(app);
                     console.log("Firebase initialized.");

                     onAuthStateChanged(auth, (user) => {
                         if (user) {
                             console.log("Auth state changed, user ID:", user.uid);
                             // Kullanıcı ID'si değiştiyse veya ilk kez set ediliyorsa
                             if (user.uid !== userId) {
                                 userId = user.uid;
                                 // Gerçek zamanlı dinleyicileri başlat (kullanıcıya özel olanlar için ID gerekir)
                                 // Sadece bir kez başlatılmalı
                                 if (!usersUnsubscribe) { // Dinleyicilerin zaten çalışıp çalışmadığını kontrol et
                                     setupRealtimeListeners(); 
                                 }
                             }
                              // Kullanıcı bilgilerini (localStorage'dan veya misafir olarak) AL ve UI'ı güncelle
                              // Bu, register/login sonrası veya sayfa yenileme sonrası çalışır
                             getUserLocationAndMetadata(); 
                         } else { 
                             console.log("No user found in auth state, attempting anonymous sign in.");
                             userId = null; 
                             signInAnonymously(auth).catch(err => console.error("Anonim giriş hatası:", err));
                             // UI Temizleme ve giriş modalını gösterme
                             document.getElementById('user-info').textContent = "Giriş Yapılmadı";
                             document.getElementById('user-location').textContent = "";
                             document.getElementById('weather-card').classList.add('hidden');
                             cleanupListeners?.(); // Dinleyicileri durdur
                             isGuest = true; // Misafir durumuna geri dön
                             document.getElementById('auth-modal').classList.remove('hidden'); 
                         }
                     });
                 }

                 // Sayfa ilk yüklendiğinde veya buton tıklandığında anonim kullanıcı yoksa giriş yapmayı dene
                 if (!auth.currentUser) {
                      console.log("No current user, attempting anonymous sign in.");
                      await signInAnonymously(auth); // Bu onAuthStateChanged'i tetikler
                 } else if (!userId) { // Eğer zaten bir kullanıcı varsa ama userId henüz set edilmemişse (nadiren olur)
                     console.log("User exists on init check, setting user ID:", auth.currentUser.uid);
                     userId = auth.currentUser.uid;
                     if (!usersUnsubscribe) setupRealtimeListeners(); // Dinleyiciler yoksa başlat
                     getUserLocationAndMetadata();
                 } else {
                     // Mevcut kullanıcı ve ID zaten varsa, bilgileri güncelle
                      getUserLocationAndMetadata();
                 }

             } catch (error) { console.error("Firebase Başlatma Hatası:", error); }
         }
        // DÜZELTİLDİ: Giriş fonksiyonları Firebase'i başlatmayı tetikler veya bilgileri günceller
        window.registerUser = () => {
            const name = document.getElementById('user-name-input').value.trim();
            const school = document.getElementById('user-school-input').value.trim();
            if (!name || !school) return showMessage("Ad ve okul alanları zorunludur.", true);
            
            localStorage.setItem('user_name', name);
            localStorage.setItem('user_school', school);
            localStorage.setItem('user_email', document.getElementById('user-email-input').value.trim());
            
            isGuest = false;
            sessionStorage.removeItem('isGuest'); 
            document.getElementById('auth-modal').classList.add('hidden');
            
            // Eğer Firebase başlatılmamışsa veya anonim kullanıcı varsa, başlat.
            // Zaten kayıtlı bir kullanıcı varsa (ki bu durumda modal görünmezdi ama yine de kontrol edelim)
            // veya anonim kullanıcı varsa, sadece bilgileri güncellemek yeterli.
            if (!app || !auth.currentUser || auth.currentUser.isAnonymous) {
                initializeFirebase(); // Bu onAuthStateChanged'i tetikleyecek
            } else {
                // Mevcut (anonim olmayan) kullanıcı var, bilgileri al/güncelle
                getUserLocationAndMetadata(); 
            }
        };

        window.loginUser = () => {
            localStorage.removeItem('user_name');
            localStorage.removeItem('user_school');
            localStorage.removeItem('user_email');
            sessionStorage.setItem('isGuest', 'true'); 
            isGuest = true;
            document.getElementById('auth-modal').classList.add('hidden');

            // Eğer Firebase başlatılmamışsa veya anonim kullanıcı varsa, başlat.
            if (!app || !auth.currentUser || auth.currentUser.isAnonymous) {
                initializeFirebase(); // Bu onAuthStateChanged'i tetikleyecek
            } else {
                getUserLocationAndMetadata();
            }
        };
        function getUserLocationAndMetadata() { /* ... Önceki kod gibi ... */ }
        async function updateUserMetadata(saveToDb) { /* ... Önceki kod gibi (fetchUserWeather çağrısı dahil) ... */ }
        
         // --- HAVA DURUMU ---
         async function fetchUserWeather(lat, lon) { /* ... Önceki kod gibi ... */ }
         function displayWeatherData(data) { /* ... Önceki kod gibi ... */ }
         function getWeatherDescription(code) { /* ... Önceki kod gibi ... */ }

        // --- Realtime Dinleyiciler ---
        function setupRealtimeListeners() { /* ... Önceki kod gibi (kullanıcı dinleyicisi dahil) ... */ }
        function cleanupListeners() { /* ... Önceki kod gibi ... */ }
        function updateGroupsData(groupsData) { /* ... Önceki kod gibi ... */ }

        // --- Harita ---
        function initializeMap() { /* ... Önceki kod gibi (setView düzeltmesi dahil) ... */ }
        function renderUserMap(users) { /* ... Önceki kod gibi (puanlı markerlar dahil) ... */ }
        
        // --- Diğer Fonksiyonlar ---
        function renderAllUsers() { /* ... Önceki kod gibi (aktif kullanıcı stilleri dahil) ... */ }
        function renderAllGroups(groups) { /* ... Önceki kod gibi (düzeltilmiş kart yapısı) ... */ }
        function renderStatusUpdateUI(groupId, currentStatus) { /* ... Önceki kod gibi ... */ }
        window.createGroup = async () => { /* ... Önceki kod gibi ... */ }
        window.joinGroup = async (groupId) => { /* ... Önceki kod gibi ... */ }
        window.leaveGroup = async (groupId) => { /* ... Önceki kod gibi ... */ }
        window.updateGroupStatus = async (groupId) => { /* ... Önceki kod gibi ... */ }
        window.uploadFile = async () => { /* ... Önceki kod gibi ... */ }
        window.deleteFile = async (id, url) => { /* ... Önceki kod gibi ... */ }
        function renderFiles(isGallery, filesToRender = allFiles) { /* ... Önceki kod gibi ... */ }
        window.publishAnnouncement = async () => { /* ... Önceki kod gibi ... */ }
        window.deleteAnnouncement = async (id) => { /* ... Önceki kod gibi ... */ }
        function renderAnnouncements(announcements) { /* ... Önceki kod gibi ... */ }
        async function loadPanelForGroup(groupId) { /* ... Önceki kod gibi ... */ }
        window.saveProjectPanel = async () => { /* ... Önceki kod gibi ... */ }
        function renderProjectGallery(panels) { /* ... Önceki kod gibi ... */ }
        function listenToLabData(groupId) { /* ... Önceki kod gibi ... */ }
        window.calculateBlueContribution = async () => { /* ... Önceki kod gibi ... */ }
        function renderContributionResults(records) { /* ... Önceki kod gibi ... */ }
        window.deleteLabRecord = async (recordId) => { /* ... Önceki kod gibi ... */ }
        function updateGroupSelectors(groups) { /* ... Önceki kod gibi ... */ }
        function displayGroupFiles(groupId) { /* ... Önceki kod gibi ... */ }
        function setupDragAndDrop() { /* ... Önceki kod gibi ... */ }
        window.clearKitCanvas = () => { /* ... Önceki kod gibi ... */ }
        
        // --- DİL FONKSİYONLARI ---
         function changeLanguage(lang) { /* ... Önceki kod gibi ... */ }
         function autoDetectLanguage() { /* ... Önceki kod gibi ... */ }
         const langSelectEl = document.getElementById('language-select');
         if (langSelectEl) {
            langSelectEl.addEventListener('change', (e) => changeLanguage(e.target.value));
         } else {
            console.error("Language select element ('language-select') not found.");
         }
        
        // BAŞLANGIÇ
        window.onload = () => {
             console.log("Window onload triggered.");
            // Oturum durumuna göre giriş modalını göster veya Firebase'i başlat
            if (localStorage.getItem('user_name') || sessionStorage.getItem('isGuest')) {
                 console.log("User or guest session found, initializing Firebase.");
                 initializeFirebase(); 
            } else {
                 console.log("No user or guest session, showing auth modal.");
                 // Modalı göstermeden önce Firebase'in anonim kullanıcı oluşturmasını bekleme
                 document.getElementById('auth-modal').classList.remove('hidden'); 
                 // Eğer Firebase henüz başlamadıysa şimdi başlat (anonim kullanıcı için)
                 if (!app) {
                     initializeFirebase();
                 }
            }
            setupDragAndDrop(); 
            autoDetectLanguage(); // Dili otomatik algıla
        };

    </script>
</body>
</html>



        function setupDragAndDrop() { /* ... */ }
        window.clearKitCanvas = () => { /* ... */ }

        // BAŞLANGIÇ
        window.onload = () => {
            // Oturum durumuna göre giriş modalını göster veya Firebase'i başlat
            if (localStorage.getItem('user_name')) {
                isGuest = false;
                initializeFirebase();
            } else if (sessionStorage.getItem('isGuest')) {
                isGuest = true;
                initializeFirebase();
            } else {
                 document.getElementById('auth-modal').classList.remove('hidden'); // Giriş yapılmamışsa modalı göster
            }
            setupDragAndDrop(); // Modül sekmesi için JS'yi yükle
        };
    </script>
</body>
</html>


